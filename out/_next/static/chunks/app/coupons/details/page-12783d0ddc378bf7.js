(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[680],{3401:function(e,s,t){Promise.resolve().then(t.bind(t,9183))},812:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});var a=t(3827),r=t(8792),l=t(7907),n=t(2382);function i(){let{user:e,logout:s}=(0,n.useAuth)(),t=(0,l.useRouter)();return(0,a.jsx)("header",{className:"main-header",children:(0,a.jsxs)("div",{className:"container header-container",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("button",{onClick:()=>t.back(),className:"w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 text-gray-600 transition-colors",title:"Go Back",children:(0,a.jsx)("i",{className:"fa-solid fa-arrow-left"})}),(0,a.jsxs)(r.default,{href:"/",className:"logo",children:[(0,a.jsx)("i",{className:"fa-solid fa-brain"}),(0,a.jsxs)("div",{className:"logo-text",children:[(0,a.jsx)("span",{children:"The"}),(0,a.jsx)("strong",{children:"Brainiacs"})]})]})]}),(0,a.jsxs)("div",{className:"search-bar",children:[(0,a.jsx)("i",{className:"fa-solid fa-magnifying-glass"}),(0,a.jsx)("input",{type:"text",placeholder:"Search coupons, brands..."})]}),(0,a.jsxs)("div",{className:"nav-icons",children:[(0,a.jsx)(r.default,{href:e?"/dashboard":"/login",className:"icon-btn highlight",title:e?"Dashboard":"Login",children:(0,a.jsx)("i",{className:"fa-regular ".concat(e?"fa-id-badge":"fa-user")})}),(0,a.jsx)(r.default,{href:"/dashboard",className:"icon-btn",children:(0,a.jsx)("i",{className:"fa-solid fa-cart-shopping"})}),(0,a.jsx)(r.default,{href:"/dashboard",className:"icon-btn",children:(0,a.jsx)("i",{className:"fa-regular fa-bell"})}),e&&(0,a.jsx)("button",{onClick:s,className:"icon-btn text-red-500",title:"Logout",children:(0,a.jsx)("i",{className:"fa-solid fa-right-from-bracket"})})]})]})})}},9183:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return u}});var a=t(3827),r=t(135),l=t(8792),n=t(4090),i=t(2382),c=t(7907);function d(e){let{coupon:s}=e,{user:t}=(0,i.useAuth)(),l=(0,c.useRouter)(),[d,o]=(0,n.useState)(s.status),[u,x]=(0,n.useState)(["sold","escrow","disputed"].includes(s.status)&&s.buyer_id===(null==t?void 0:t.id)),[m,h]=(0,n.useState)(!1),[f,g]=(0,n.useState)(!1),[b,p]=(0,n.useState)(null),[j,N]=(0,n.useState)(!1),[v,y]=(0,n.useState)(null),w=/^[A-Za-z0-9-]{4,20}$/;(0,n.useEffect)(()=>{o(s.status),["sold","escrow","disputed"].includes(s.status)&&t&&s.buyer_id===t.id&&x(!0)},[s,t]);let k=async()=>{if(!t){alert("Please login to purchase coupons."),l.push("/login");return}h(!0);try{let{error:e}=await r.O.from("coupons").update({status:"escrow",buyer_id:t.id}).eq("id",s.id);if(e)throw e;x(!0),o("escrow"),alert("Funds held securely in Escrow! You can now test the code."),w.test(s.code)?p("valid"):p("invalid")}catch(e){console.error("Purchase failed:",e),alert("Failed to purchase coupon. It might already be sold.")}finally{h(!1)}},_=async e=>{g(!0);try{let{error:t}=await r.O.from("coupons").update({status:e}).eq("id",s.id);if(t)throw t;o(e),"sold"===e?alert("Purchase Finalized! Funds released to seller."):alert("Transaction Disputed. An admin will review your claim.")}catch(e){console.error("Resolution failed:",e),alert("Failed to update status.")}finally{g(!1)}};return(0,a.jsxs)("div",{className:"flex flex-col h-full",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-6",children:[(0,a.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800 border border-green-200",children:[(0,a.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),"Verified by AI"]}),(0,a.jsxs)("span",{className:"text-sm ".concat(new Date(s.expiry_date)<new Date?"text-red-500 font-bold":"text-gray-500"),children:["Expires: ",s.expiry_date?s.expiry_date.split("-").reverse().join("/"):"N/A"]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl text-gray-500 uppercase font-medium tracking-wide",children:s.brand_name}),(0,a.jsx)("h1",{className:"mt-2 text-4xl font-extrabold text-[#E50914] sm:text-5xl",children:s.discount_value||"Discount"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600 text-lg leading-relaxed",children:s.description})]}),(0,a.jsx)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-6 mb-8 text-center relative overflow-hidden group transition-all duration-300",children:u?(0,a.jsxs)("div",{className:"animate-fade-in",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-2",children:"Your Coupon Code:"}),(0,a.jsx)("div",{className:"text-3xl font-mono font-bold text-[#222] tracking-wider select-all bg-white p-2 rounded border border-dashed border-gray-300",children:s.code}),"escrow"===d&&(0,a.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg text-left",children:[(0,a.jsxs)("h4",{className:"text-sm font-bold text-blue-800 mb-2",children:[(0,a.jsx)("i",{className:"fa-solid fa-shield-halved"})," Payment held in Escrow"]}),(0,a.jsx)("p",{className:"text-xs text-blue-600 mb-4",children:"Please verify the code works on the brand's website before releasing funds to the seller."}),(0,a.jsxs)("div",{className:"flex gap-2 justify-center",children:[(0,a.jsxs)("button",{onClick:()=>_("sold"),disabled:f,className:"flex-1 bg-green-600 text-white px-4 py-2 rounded font-bold text-sm hover:bg-green-700 transition",children:[(0,a.jsx)("i",{className:"fa-solid fa-check mr-1"})," Code Worked"]}),(0,a.jsxs)("button",{onClick:()=>_("disputed"),disabled:f,className:"flex-1 bg-red-500 text-white px-4 py-2 rounded font-bold text-sm hover:bg-red-600 transition",children:[(0,a.jsx)("i",{className:"fa-solid fa-xmark mr-1"})," Invalid Code"]})]})]}),"disputed"===d&&(0,a.jsxs)("div",{className:"mt-6 p-4 bg-orange-50 border border-orange-200 rounded-lg text-left",children:[(0,a.jsxs)("h4",{className:"text-sm font-bold text-orange-800",children:[(0,a.jsx)("i",{className:"fa-solid fa-gavel"})," Transaction Disputed"]}),(0,a.jsx)("p",{className:"text-xs text-orange-600 mt-1",children:"This transaction is frozen and under administrative review."})]}),"sold"===d&&(0,a.jsx)("div",{className:"mt-6 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,a.jsxs)("h4",{className:"text-sm font-bold text-green-800",children:[(0,a.jsx)("i",{className:"fa-solid fa-check-double"})," Purchase Complete"]})}),(0,a.jsxs)("div",{className:"mt-3",children:["valid"===b&&(0,a.jsxs)("span",{className:"text-green-600 text-sm flex items-center justify-center",children:[(0,a.jsx)("i",{className:"fa-solid fa-check-circle mr-1"})," Format Validated"]}),"invalid"===b&&(0,a.jsxs)("span",{className:"text-red-500 text-sm flex items-center justify-center",children:[(0,a.jsx)("i",{className:"fa-solid fa-triangle-exclamation mr-1"})," Invalid Format Detected"]})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"absolute inset-0 bg-white/60 backdrop-blur-[2px] z-10 flex flex-col items-center justify-center transition-opacity duration-300",children:[(0,a.jsx)("svg",{className:"w-8 h-8 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),(0,a.jsx)("span",{className:"text-sm font-semibold text-gray-600 uppercase tracking-wider",children:"Purchase to Unlock"})]}),(0,a.jsx)("span",{className:"text-2xl font-mono font-bold text-gray-300 select-none blur-sm",children:"XXXX-XXXX-XXXX"})]})}),(0,a.jsxs)("div",{className:"mt-auto",children:[u?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("span",{className:"text-gray-500 text-sm",children:"Unlock Price"}),(0,a.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:s.price||"FREE"})]}),(0,a.jsx)("button",{onClick:k,className:"w-full bg-[#E50914] text-white py-4 px-6 rounded-lg font-bold text-lg shadow-lg hover:bg-red-700 hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",disabled:m,children:m?"Processing...":"Buy Now"})]}),(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Secure transaction • Instant delivery • 100% Verified"})})]})]})}var o=t(812);function u(){var e;let s=(0,c.useSearchParams)().get("id"),[t,i]=(0,n.useState)(null),[u,x]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{(async()=>{let{data:e,error:t}=await r.O.from("coupons").select("*").eq("id",s).single();!t&&e&&i(e),x(!1)})()},[s]),u)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center text-gray-500",children:(0,a.jsx)("p",{children:"Loading..."})}):t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.Z,{}),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"max-w-5xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden",children:(0,a.jsxs)("div",{className:"md:flex",children:[(0,a.jsx)("div",{className:"md:flex-shrink-0 md:w-1/2 bg-gray-100 flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center p-8",children:[(0,a.jsx)("div",{className:"w-32 h-32 mx-auto bg-white rounded-full flex items-center justify-center shadow-sm mb-4",children:(0,a.jsx)("span",{className:"text-4xl font-bold text-gray-400",children:(null===(e=t.brand_name)||void 0===e?void 0:e.charAt(0).toUpperCase())||"B"})}),(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:"Brand Image Placeholder"})]})}),(0,a.jsx)("div",{className:"p-8 md:p-12 md:w-1/2 flex flex-col justify-center",children:(0,a.jsx)(d,{coupon:t})})]})}),(0,a.jsx)("div",{className:"max-w-5xl mx-auto mt-8 text-center",children:(0,a.jsx)(l.default,{href:"/marketplace",className:"text-gray-500 hover:text-[#E50914] transition-colors",children:"← Back to all coupons"})})]})]}):(0,a.jsxs)("div",{className:"min-h-screen flex items-center justify-center text-gray-500",children:[(0,a.jsx)("p",{children:"Coupon not found or has expired."}),(0,a.jsx)(l.default,{href:"/marketplace",className:"ml-4 text-[#E50914] hover:underline",children:"Back to Marketplace"})]})}},2382:function(e,s,t){"use strict";t.r(s),t.d(s,{AuthProvider:function(){return c},useAuth:function(){return d}});var a=t(3827),r=t(4090),l=t(135),n=t(7907);let i=(0,r.createContext)();function c(e){let{children:s}=e,[t,c]=(0,r.useState)(null),[d,o]=(0,r.useState)(!0),u=(0,n.useRouter)();(0,r.useEffect)(()=>{let e=localStorage.getItem("user_id");e?x(e):o(!1)},[]);let x=async e=>{try{let{data:s,error:t}=await l.O.from("users").select("*").eq("id",e).single();if(t)throw t;s&&c(s)}catch(e){console.error("Error fetching user:",e),"PGRST116"===e.code&&localStorage.removeItem("user_id")}finally{o(!1)}},m=async e=>{o(!0);try{let{data:s,error:t}=await l.O.from("users").select("*").eq("phone_number",e).single();if(!s)return o(!1),{success:!1,status:"USER_NOT_FOUND"};return c(s),localStorage.setItem("user_id",s.id),{success:!0,user:s}}catch(e){return console.error("Login Error:",e),{success:!1,error:e}}finally{o(!1)}},h=async e=>{o(!0);try{let{data:s,error:t}=await l.O.from("users").insert([e]).select().single();if(t)throw t;return c(s),localStorage.setItem("user_id",s.id),{success:!0,user:s}}catch(e){return console.error("Registration Error:",e),{success:!1,error:e}}finally{o(!1)}};return(0,a.jsx)(i.Provider,{value:{user:t,loading:d,loginWithPhone:m,registerUser:h,logout:()=>{c(null),localStorage.removeItem("user_id"),u.push("/login")}},children:s})}let d=()=>(0,r.useContext)(i)},135:function(e,s,t){"use strict";t.d(s,{O:function(){return n}});var a=t(7688);let r="https://zlpjahdoxdbjzpvxuosp.supabase.co",l="sb_publishable_dqwGMGOwDlbN79ObqqM8gg_mRKsxNcu";if(!r||!l)throw Error("Missing Supabase environment variables");let n=(0,a.eI)(r,l)}},function(e){e.O(0,[436,792,971,69,744],function(){return e(e.s=3401)}),_N_E=e.O()}]);